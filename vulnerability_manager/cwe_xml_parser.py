#!/bin/python3

import xml.etree.ElementTree as etree

class CweXmlParser():

    def __init__(self, ignore_before_date=None):
        self.cwe_list = []

    def clean_text(self, txt):
        return txt.replace("\n", " ").replace("\t", "")
        
    def parse(self, filename):
        tree = etree.parse(filename)
        root = tree.getroot()

        entries = []
        for cat in ["Categories", "Weaknesses", "Compound_Elements"]:
            entries += root.find(cat).getchildren()
        
        for entry in entries:
            cwe = {}

            cwe["cweid"] = "CWE-" + entry.get("ID")
            cwe["title"] = entry.get("Name")
            
            desc = entry.find("Description")
            cwe["summary"] = self.clean_text(desc.find("Description_Summary").text)
            
            extended = []

            if desc.find("Extended_Description"):
                for l in desc.find("Extended_Description"):
                    extended.append(self.clean_text(l.text))

            cwe["description"] = " ".join(extended)
            
            self.cwe_list.append(cwe)
